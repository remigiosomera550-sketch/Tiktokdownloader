<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TikTok Downloader â€” Simple UI</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, Roboto, sans-serif;margin:0;background:linear-gradient(180deg,#071028 0%, #071428 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:880px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .row{display:flex;gap:10px;margin-bottom:12px}
    input[type=text]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#022;cursor:pointer;font-weight:600}
    .small{font-size:13px;color:var(--muted)}
    .result{margin-top:14px;border-radius:10px;padding:12px;background:rgba(255,255,255,0.02);display:grid;grid-template-columns:1fr 230px;gap:12px;align-items:center}
    video{width:100%;border-radius:8px;background:#000}
    .meta{display:flex;flex-direction:column;gap:8px}
    a.button{display:inline-block;padding:10px 12px;border-radius:8px;text-decoration:none;background:#0ea5a4;color:#022;font-weight:700}
    .error{color:#ffb4b4;background:rgba(255,80,80,0.06);padding:8px;border-radius:8px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media(max-width:720px){.result{grid-template-columns:1fr;}.row{flex-direction:column}a.button{width:100%;text-align:center}}
  </style>
</head>
<body>
  <div class="card">
    <h1>ð–£˜ TikTokDL â€” Simple Downloader</h1>
    <p class="lead">Paste a TikTok share link below. This UI calls the API you gave and shows a preview + download button (if the API returns a downloadable URL).</p>

    <div class="row">
      <input id="tlink" type="text" placeholder="Paste TikTok share URL here" value="https://www.tiktok.com/@fatcat8210/video/7563877507829632263" />
      <button id="go">Fetch</button>
    </div>

    <div class="small">CORS note: If you get a CORS error in the browser, either host this HTML on a server that can call the API (recommended) or set a CORS proxy below.</div>

    <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
      <label class="small" style="white-space:nowrap">CORS proxy (optional):</label>
      <input id="proxy" type="text" placeholder="e.g. https://api.allorigins.win/raw?url=" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)" />
    </div>

    <div id="out" style="margin-top:14px"></div>

    <footer>Tip: if the API's response contains <code>downloadUrls: [null]</code> the API didn't return a usable direct URL â€” try a different endpoint or run server-side proxy to avoid CORS & token restrictions.</footer>
  </div>

<script>
  // Replace the baseApi if you host your own backend or different provider
  const BASE_API = 'https://betadash-api-swordslush-production.up.railway.app/api/tiktok?link=';

  const go = document.getElementById('go');
  const out = document.getElementById('out');
  const tlink = document.getElementById('tlink');
  const proxyInput = document.getElementById('proxy');

  function setHtml(html){ out.innerHTML = html }

  function human(e){ return JSON.stringify(e, null, 2) }

  async function fetchWithTimeout(url, opts = {}, ms = 15000) {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), ms);
    try {
      const r = await fetch(url, {...opts, signal: controller.signal});
      clearTimeout(id);
      return r;
    } catch (err) {
      clearTimeout(id);
      throw err;
    }
  }

  function makeDownloadButton(url){
    const a = document.createElement('a');
    a.href = url;
    a.download = '';
    a.className = 'button';
    a.textContent = 'Download video';
    a.target = '_blank';
    return a;
  }

  function showError(msg){
    setHtml('<div class="error">'+(msg||'Error')+'</div>')
  }

  go.addEventListener('click', async ()=>{
    const url = tlink.value.trim();
    if(!url){ showError('Please paste a TikTok share link.'); return; }

    setHtml('<div class="small">Fetchingâ€¦</div>');

    try {
      let apiUrl = BASE_API + encodeURIComponent(url);
      const proxy = proxyInput.value.trim();
      if(proxy){
        // If proxy looks like e.g. https://api.allorigins.win/raw?url=  -> we append the full apiUrl
        // If proxy expects the target appended directly, user can paste it here. Keep flexible.
        if(proxy.endsWith('=') || proxy.includes('{url}')){
          apiUrl = proxy.replace('{url}', encodeURIComponent(apiUrl)) + ''; // support {url} token
          if(proxy.endsWith('=')) apiUrl = proxy + encodeURIComponent(apiUrl);
        } else {
          // user likely provided a proxy service that expects the target in the path
          apiUrl = proxy + encodeURIComponent(apiUrl);
        }
      }

      const resp = await fetchWithTimeout(apiUrl, {method:'GET', mode:'cors'}, 20000);
      if(!resp.ok){
        // If CORS blocked, resp.ok might be false or fetch threw; tell user
        throw new Error('Network response not ok â€” status ' + resp.status);
      }

      const data = await resp.json();

      // Basic defensive checks for different shapes
      // Many tiktok downloader APIs return a field like downloadUrls, videoUrl, directUrl, result, etc.
      let videoUrl = null;

      if(Array.isArray(data.downloadUrls)){
        // pick first non-null and non-empty
        for(const v of data.downloadUrls){ if(v){ videoUrl = v; break } }
      }
      if(!videoUrl){ videoUrl = data.downloadUrl || data.videoUrl || data.url || data.result || (data.data && (data.data.playAddr || data.data.video || data.data.videoUrl)); }

      // If the API returns an object with nested fields, try to find playAddr
      if(!videoUrl && data.data && typeof data.data === 'object'){
        // shallow search for url-like strings
        for(const k of Object.keys(data.data)){
          const v = data.data[k];
          if(typeof v === 'string' && v.startsWith('http')){ videoUrl = v; break }
          if(typeof v === 'object'){
            for(const k2 of Object.keys(v||{})){
              const vv = v[k2];
              if(typeof vv === 'string' && vv.startsWith('http')){ videoUrl = vv; break }
            }
            if(videoUrl) break;
          }
        }
      }

      // If still no direct url, show raw JSON and hint
      if(!videoUrl){
        setHtml('<div class="small">No direct download URL found in API response. Below is the full JSON returned by the API (inspect for fields that may contain a URL).<pre style="white-space:pre-wrap;background:#001221;padding:10px;border-radius:8px;margin-top:8px">'+escapeHtml(human(data))+'</pre></div>');
        return;
      }

      // Build preview + download link
      const videoTag = document.createElement('video');
      videoTag.controls = true;
      videoTag.src = videoUrl;

      const meta = document.createElement('div');
      meta.className = 'meta';

      const title = document.createElement('div');
      title.innerHTML = '<strong>' + (escapeHtml(data.title || 'TikTok video')) + '</strong>';

      const info = document.createElement('div');
      info.className = 'small';
      info.textContent = 'Source: ' + (new URL(url).hostname || 'TikTok');

      const dl = makeDownloadButton(videoUrl);

      meta.appendChild(title);
      meta.appendChild(info);
      meta.appendChild(dl);

      out.innerHTML = '';
      const container = document.createElement('div');
      container.className = 'result';
      const left = document.createElement('div');
      left.appendChild(videoTag);
      container.appendChild(left);
      container.appendChild(meta);
      out.appendChild(container);

    } catch (err) {
      console.error(err);
      if(err.name === 'AbortError') showError('Request timed out. Try again or remove proxy.');
      else if(err.message && err.message.toLowerCase().includes('cors')) showError('CORS error when calling the API â€” use a server-side proxy or set the "CORS proxy" input.');
      else showError(err.message || String(err));
    }
  });

  // small helper to escape JSON / text for insertion
  function escapeHtml(s){
    if(!s) return '';
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  // allow pressing enter in input
  tlink.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ go.click(); } });

</script>
</body>
</html>
